TODO
====

* rewrite with events (prepare for streams)
* rewrite with streams (Environment = server, AgentProgram = browser)
